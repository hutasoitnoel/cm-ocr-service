(()=>{var t={925:t=>{t.exports=t=>{const s=Object.keys(t).length,e=Object.values(t).filter((t=>null!=t&&""!==t)).length;return Number((e/s*100).toFixed(0))}},755:(t,s,e)=>{const r=e(925);t.exports=t=>{const s=(e={type:"KTP",province:t.match(/PROVINSI\s+(.*)/i)?.[1]?.trim(),city:t.match(/JAKARTA\s+BARAT/i)?.[0]?.trim(),id_number:t.match(/NIK\s*:\s*([\d]+)/i)?.[1]?.trim(),name:t.match(/Nama\s*:\s*(.*)/i)?.[1]?.trim(),dob:t.match(/Tempat.*:\s*(.*)/i)?.[1]?.trim(),gender:t.match(/Jenis Kelamin\s*:\s*(\w+)/i)?.[1]?.trim(),blood_type:t.match(/Gol\. Darah\s*:\s*(\w+)/i)?.[1]?.trim(),address:t.match(/Alamat\s*:\s*(.*)/i)?.[1]?.trim(),rt_rw:t.match(/RTRW\s*:\s*([\d\/]+)/i)?.[1]?.trim(),sub_district:t.match(/(?:KeliDesa.*?:|Kel\/Desa\s*:\s*)(.*)/i)?.[1]?.trim(),district:t.match(/Kecamatan\s*:\s*(.*)/i)?.[1]?.trim(),religion:t.match(/Agama\s*:\s*(.*)/i)?.[1]?.trim(),marital_status:t.match(/Status Perkawinan\s*:\s*(.*)/i)?.[1]?.trim(),occupation:t.match(/Pekerjaan\s*:\s*(.*)/i)?.[1]?.trim(),citizenship:t.match(/Kewarganegaraan\s*:\s*(.*)/i)?.[1]?.trim(),expiration_date:t.match(/Berlaku Hingga\s*:\s*(.*)/i)?.[1]?.trim()},{...e,religion:e.religion?.split(/\s/)[0]||e.religion,marital_status:e.marital_status?.split(/\s/)[0]||e.marital_status,sub_district:e.sub_district?.split(/\s/)[0]||e.sub_district,district:e.district?.split(/\s/)[0]||e.district,citizenship:e.citizenship?.split(/\s/)[0]||e.citizenship,expiration_date:e.expiration_date?.split(/\s/)[0]||e.expiration_date});var e;return{score:r(s),data:s}}},565:(t,s,e)=>{const r=e(925),i=t=>{const s=t.split("\n").map((t=>t.trim()));let e="",r=!1;for(const t of s)if(t.startsWith("4."))r=!0,e+=t.replace("4.","").trim()+" ";else{if(t.includes("5.")){r=!1;break}r&&(e+=t+" ")}return e.trim()},a=t=>{const s=t.match(/\d{2}-\d{2}-\d{4}/g);return s?s[s.length-1]:null};t.exports=t=>{const s=((t,s)=>{try{return{...t,address:i(s)}}catch(s){return t}})({type:"SIM",name:t.match(/1\.\s*(.*)/)?.[1]?.trim(),dob:t.match(/2\.\s*(.*)/)?.[1]?.trim(),blood_type:t.match(/3\.\s*(.*)/)?.[1]?.split("-")[0]?.trim(),gender:t.match(/3\.\s*(.*)/)?.[1]?.split("-")[1]?.trim(),address:t.match(/4\.\s*(.*)/)?.[1]?.trim(),occupation:t.match(/5\.\s*(.*)/)?.[1]?.trim(),place_of_issue:t.match(/6\.\s*(.*)/)?.[1]?.trim().split(/\s/)[0],expiration_date:a(t),id_number:t.match(/[\w$]{4}-[\w$]{4}-[\w$]{6}/)?.[0]?.trim()},t);return{score:r(s),data:s}}},577:t=>{"use strict";t.exports=require("cors")},818:t=>{"use strict";t.exports=require("dotenv")},252:t=>{"use strict";t.exports=require("express")},461:t=>{"use strict";t.exports=require("multer")},288:t=>{"use strict";t.exports=require("sharp")},887:t=>{"use strict";t.exports=require("tesseract.js")}},s={};function e(r){var i=s[r];if(void 0!==i)return i.exports;var a=s[r]={exports:{}};return t[r](a,a.exports,e),a.exports}const{createWorker:r}=e(887),i=e(252),a=e(461),o=e(288),c=e(577);e(818).config();const n=e(755),m=e(565),l=i();l.use(c({origin:process.env.UI_BASE_URL,credentials:!0}));const u=a.memoryStorage(),p=a({storage:u});l.get("/ping",((t,s)=>s.status(200).json({message:"pong!"}))),l.post("/upload",p.single("image"),(async(t,s)=>{if(!t.file)return s.status(400).json({error:"No file uploaded."});try{console.log("Processing image in memory");const e=await o(t.file.buffer).grayscale().threshold(150).resize({width:1200}).toBuffer(),i=await r("ind");await i.setParameters({tessedit_char_whitelist:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz,-./: "});const a=await i.recognize(e);let c;const l=n(a.data.text),u=m(a.data.text);return c=l.score>u.score?l.data:u.data,console.log("OCR Result:"),console.log(a.data.text),console.log(n(a.data.text)),console.log(m(a.data.text)),s.status(200).json(c)}catch(t){return console.error("Error processing image:",t),s.status(500).json({error:"Error processing image."})}})),l.listen(process.env.PORT,(()=>{console.log(`Server is running at port ${process.env.PORT}`)}))})();